<!DOCTYPE HTML><html lang="fr" prefix="og: http://ogp.me/ns#"><head><title>Configurer son nœud Bitcoin Lightning Network</title><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="theme-color" content="#0070FC"/><meta name="author" content="Jonathan Serra"/><meta property="og:url" content="https://blocs.fr"/><meta property="og:title" content="Configurer son nœud Bitcoin Lightning Network"/><meta property="og:description" content="Dans l&#x27;article précédent j&#x27;ai écrit au sujet de l&#x27;installation d&#x27;un nœud Bitcoin Lightning Network avec un Raspberry Pi. Ce dernier est sommaire et va à l&#x27;essentiel. Dans cet article il va s&#x27;agir d&#x27;optimiser la configuration du Raspberry Pi afin d&#x27;améliorer sa sécurité et rendre l&#x27;administration moins laborieuse."/><meta name="description" content="Dans l&#x27;article précédent j&#x27;ai écrit au sujet de l&#x27;installation d&#x27;un nœud Bitcoin Lightning Network avec un Raspberry Pi. Ce dernier est sommaire et va à l&#x27;essentiel. Dans cet article il va s&#x27;agir d&#x27;optimiser la configuration du Raspberry Pi afin d&#x27;améliorer sa sécurité et rendre l&#x27;administration moins laborieuse."/><meta name="keywords" content="debian,bitcoind,bitcoin-cli"/><meta property="og:image" content="/res/d135126d.jpg"/><meta property="og:image:alt" content="Installer un noeud Bitcoin-Comment fonctionne bitcoin-Installer Bitcoin"/><meta property="og:type" content="blog"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@_blocs"/><meta name="twitter:creator" content="@_blocs"/><meta property="article:author" content="Jonathan Serra"/><script defer="">const storageKey="blocs-data-theme";document.addEventListener("DOMContentLoaded",(function(){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;let t=window.localStorage.getItem(storageKey);t||(t=e?"dark":"light");const a=document.querySelector("#theme-switch");a&&(activateTheme(t,a),a.addEventListener("click",(()=>{switch(t){case"dark":t="light";break;default:t="dark"}window.localStorage.setItem(storageKey,t),activateTheme(t,a)})))}));const activateTheme=(e,t)=>{const a=t.childNodes[0],c=t.childNodes[1];switch(e){case"light":c.style.display="block",a.style.display="none";break;case"dark":default:c.style.display="none",a.style.display="block"}document.documentElement.setAttribute("data-theme",e)};</script><script src="/res/1699ad49.js" defer=""></script><style>@keyframes ripple{to{transform:scale(4);opacity:0}}@font-face{font-family:Inter;font-weight:100 900;font-display:swap;font-style:normal;font-named-instance:"Regular";src:url(/res/541fae2e.woff2);font-display:fallback}@font-face{font-family:Inter;font-weight:100 900;font-display:swap;font-style:italic;font-named-instance:"Regular";src:url(/res/1517082.woff2);font-display:fallback}@font-face{font-family:'icons';font-display:swap;src:url(/res/12b0a8fb.woff2);font-weight:400;font-style:normal;font-display:fallback}.a:before,[class*=" icon-"]:before,[class^=icon-]:before{font-family:"icons";font-style:normal;font-weight:400;speak:never;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*,::after,::before{box-sizing:border-box}*{font-weight:var(--b)}@supports (font-variation-settings:"wght" 400){*{font-weight:inherit;font-variation-settings:"wght" var(--b)}}:root{--a:#0070FC;--c:#FBE016;--d:#0CF477;--e:#9e9e9e;--f:white;--g:black;--h:#000F26;--i:#eee;--j:12px;--k:12px}::selection{background-color:var(--a);color:#fff}[data-theme=light]{--f:#111;--c:#E3078F;--e:#667;--g:#fafafa;--h:#fcfcfe;--i:#333}body{margin:var(--j) var(--k) 64px;font:18px/26px Inter,system-ui,-apple-system,sans-serif;color:var(--f);background:var(--h);line-height:28px;max-width:100%;overflow-x:hidden}a{text-decoration:none;color:var(--a)}.I .K>div a:hover,a:active,a:hover{text-decoration:underline}.b a span{font-size:26px}.c{float:left;margin-left:-24px}a:active,a:focus,a:hover{text-decoration:underline}.d{display:flex;padding-top:12px;margin:-12px calc(-1*var(--k)) 48px;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch}.d::after,.d::before{display:block;content:"";padding-right:var(--k)}.e,.f{flex:none;--b:700}.e{display:block;font-size:24px;line-height:18px;letter-spacing:-1px;text-transform:lowercase;border-top:4px solid;padding:6px 4px 0 0}a.e{color:currentColor;text-decoration:none}.f{margin:0 0 0 24px;font-size:6px;line-height:10px;letter-spacing:1px;text-transform:uppercase;width:0}.g{margin-left:auto}.h{flex:none;display:block;margin:10px 24px 0 0;font-size:14px;color:var(--f);--b:600;line-height:18px}.h:last-child{margin-right:0}.i{display:block;cursor:pointer;font-size:16px;min-width:125px;margin:0 auto;color:var(--f);padding:13px;text-decoration:none;border:1px solid var(--f);border-radius:6px;background-color:transparent;outline:0;height:44px;max-height:44px;min-height:44px;line-height:14px;transform:translate(0,0);transition:all;transition-duration:123ms}.i.j{background-color:var(--a);border-color:var(--a);color:#fff;font-weight:700}#isso-thread input[type=button]:hover,#isso-thread input[type=submit]:hover,.i:hover{transform:translate(-2px,-2px);box-shadow:2px 2px 1px var(--i)}#isso-thread input[type=button]:active,#isso-thread input[type=submit]:active,.i:active{transform:translate(0,0);box-shadow:inset 0 0 7px var(--i)}.k>span{position:absolute;border-radius:50%;transform:scale(0);animation:ripple 400ms linear;background-color:rgba(255,255,255,.5)}@media (min-width:768px){:root{--k:64px}}@media (min-width:1024px){:root{--k:128px}}.l:before{content:'\f16d'}.m:before{content:'\f300'}.o:before{content:'\f167'}.n:before{content:'\f30c'}.p:before{content:'\f2c6'}.q:before{content:'\E800'}.r:before{content:'\F186'}.s:before{content:'\F309'}:root{--k:max(12px, (100vw - var(--m)) / 2);--m:800px}h1{margin:48px 0 32px;font-size:36px;line-height:48px;letter-spacing:-.8px}.C p,h1,h2{font-weight:700}h2,h3{margin:42px 0 18px;font-size:26px;line-height:34px;letter-spacing:-.3px}h3{font-size:22px;line-height:30px;letter-spacing:-.18px}p{margin:18px 0}.C,.D li{display:flex;flex-direction:row}.C p{margin-right:12px;margin-top:0;margin-bottom:5px;color:var(--c)}p>code{word-break:break-all}blockquote code,em>code{font-style:normal}.D a,h3,strong{font-weight:600}ul.D{margin:24px 0;padding-left:32px;margin-left:calc(-32*min(max(var(--k) - 32px,0px),1px))}.D a{color:var(--f)}.D li{overflow:hidden;position:relative;list-style:none;margin:2px 0 30px;border-radius:8px}.D picture{margin-top:5px;margin-right:20px}.D picture *{border-radius:5px}#isso-thread #isso-root ._,.E,.I .K>div{margin:0}.F{font-size:16px;margin:5px 0}.C p,i{font-size:14px}blockquote{line-height:32px;font-weight:300;font-style:italic;color:var(--e)}table{margin:24px;border-collapse:separate;border-spacing:12px 0}thead th{border-bottom:var(--l) solid;--b:600;text-align:left}code,pre code{background-color:var(--g)}code{font-size:.9em;font-family:monospace;padding:1px 5px;border:1px dotted var(--c);border-radius:4px}pre code{display:block;width:100vw;margin:48px calc(-1*var(--k));padding:18px var(--k);border-width:0;border-radius:0;overflow-x:scroll}video{display:block;max-width:100%;margin:32px auto}iframe{width:calc(var(--n)*1);height:calc(var(--n)*.66);border:1px solid rgba(0,0,0,.1);--n:calc(100vw - 2 * var(--k))}.G{color:#9e9e9e}.H{cursor:pointer}.I{display:flex;flex-wrap:wrap-reverse}.I .J>p{padding-top:0;margin-top:0}.I .K .L{margin-bottom:7px}.I .J{flex:1;margin-right:15px;width:400px}.I .K{padding:17px;background-color:var(--g);border-radius:4px;border-width:1px;border-color:var(--f);border-style:solid;overflow:hidden;max-width:350px}.I .K h2{margin:0 0 10px}.I .K>div div{margin-left:20px}.I .K>div a{display:block;text-decoration:none}.M{box-shadow:7px 10px 15px rgba(10,10,10,.2)}.M .N{height:10px;width:10px;border-radius:50%;border:1px solid #000;position:relative;top:6px;left:6px;background-color:#ff3b47;border-color:#9d252b;display:inline-block;vertical-align:top}.N.O{left:11px;background-color:#ffc100;border-color:#9d802c}.N.P{left:16px;background-color:#00d742;border-color:#049931}.M .Q{position:relative;width:100%;height:25px;background-color:#bbb;margin:0 auto;border-top-right-radius:5px;border-top-left-radius:5px}.M .R,.M .S{display:inline-block}.M .R{position:absolute}.M .S{color:#333;width:100%;padding:0;margin:0;text-align:center;font-size:12px;font-weight:700;vertical-align:top;line-height:25px}.M .T{background-color:#000;color:#fff;box-sizing:border-box;width:100%;margin:0 auto;padding:20px;border-bottom-left-radius:5px;border-bottom-right-radius:5px;font-size:16px}.M .U{font-family:monospace!important;padding:0;margin:0}.M .V{color:var(--c);font-weight:700;margin-right:7px}.M .W{background-color:#fff}.M i{color:#666}#isso-thread h4{display:none}#isso-thread input[type=button],#isso-thread input[type=submit]{cursor:pointer;font-size:16px;width:125px;margin:0 auto;color:var(--f);padding:13px;text-decoration:none;border:1px solid #fff;border-radius:6px;background-color:transparent;outline:0;height:44px;max-height:44px;min-height:44px;line-height:14px;transform:translate(0,0);transition:all;transition-duration:123ms}#isso-thread input[type=submit]{background-color:var(--a);border-color:var(--a);color:#fff}#isso-thread input[type=checkbox]{margin-right:6px}#isso-thread>div>div>div>div,.M .W{color:#000}#isso-thread label{color:#fff}#isso-thread h1,#isso-thread h2,#isso-thread h3,#isso-thread h4,#isso-thread h5,#isso-thread h6{margin:0;line-height:1em}#isso-thread h1{font-size:2em}#isso-thread h2{font-size:1.6}#isso-thread h3{font-size:1.2}#isso-thread #isso-root b,#isso-thread #isso-root h1,#isso-thread #isso-root h2,#isso-thread #isso-root h3,#isso-thread #isso-root i,#isso-thread #isso-root p,#isso-thread #isso-root strong,#isso-thread code,#isso-thread section label,.I .K h2{color:var(--f)}#isso-thread input[type=email],#isso-thread input[type=text]{margin-bottom:15px;padding:10px 0 10px 10px;background-color:transparent;border:0;border-bottom:1px solid var(--f);border-radius:0;outline-color:var(--i);color:var(--f);margin-right:10px}#isso-thread .X::placeholder,#isso-thread input[type=email]::placeholder,#isso-thread input[type=text]::placeholder{color:var(--e)}#isso-thread .X::active,#isso-thread .X:focus,#isso-thread input[type=email]:active,#isso-thread input[type=email]:focus,#isso-thread input[type=text]:active,#isso-thread input[type=text]:focus{border-color:var(--a)!important}#isso-thread input[name=website]{display:none}#isso-thread .Y{margin-top:30px}#isso-thread .Y>.Z{padding-right:15px}#isso-thread preview{background:0 0;border:0;box-shadow:none}#isso-thread>div:first-of-type>div:first-of-type>div:first-of-type>div:first-of-type{min-height:100px!important;font-size:14px}#isso-thread>div:first-of-type>div:first-of-type>div:first-of-type>div:first-of-type>div:first-of-type{max-height:1.5em}#isso-thread #isso-root .-a{color:#fff!important}.-b h2{margin-bottom:0;padding-bottom:0}.-b p{margin-top:0}.-b i{font-size:14px}@media (min-width:768px){a,p>code{word-break:initial}}@media (max-width:484px){.D li{flex-direction:column}.D li img{width:100%}.D{padding:0 15px!important}.D picture{margin-bottom:10px;margin-right:0}.c{margin-left:0;margin-right:8px}}.-e,.-f{color:#a0a1a7;font-style:italic}.-g,.-h,.-i{color:#a626a4}.-j,.-k,.-l,.-m,.-n{color:#e45649}.-o{color:#0184bb}.-p,.-q,.-r,.-s,.-t{color:#50a14f}.-u,.-v .-w{color:#c18401}.-A,.-B,.-C,.-D,.-E,.-x,.-y,.-z{color:#986801}.-F,.-G,.-H,.-I,.-J,.-w{color:#4078f2}.-K{font-style:italic}.-L{font-weight:700}.-H{text-decoration:underline}@media (prefers-color-scheme:dark){.-e,.-f{color:#5c6370;font-style:italic}.-g,.-h,.-i{color:#c678dd}.-j,.-k,.-l,.-m,.-n{color:#e06c75}.-o{color:#56b6c2}.-p,.-q,.-r,.-s,.-t{color:#98c379}.-u,.-v .-w{color:#e6c07b}.-A,.-B,.-C,.-D,.-E,.-x,.-y,.-z{color:#d19a66}.-F,.-G,.-H,.-I,.-J,.-w{color:#61aeee}.-K{font-style:italic}.-L{font-weight:700}.-H{text-decoration:underline}}.-M{padding:0 8px;vertical-align:top;cursor:pointer;color:var(--a)}.-M:hover{text-decoration:underline}.-N{position:absolute;opacity:0;color:#fff;font-weight:700;background-color:var(--a);padding:5px 10px;margin-left:10px;border-radius:6px;font-size:14px;transition:123ms}</style><script defer="">document.documentElement.style.setProperty("--l",1/(window.devicePixelRatio||1)+"px");</script></head><body><div class="d"><a href="/" class="e">Blocs<br/>.fr</a><div class="f">Site</div><a href="/" class="h" title="Accéder à Home">Home</a><div class="f g">Cool</div><a href="/bitcoin-nostalgia" class="h" title="Accéder à Go BTC">Go BTC</a><a href="/blog" class="h" title="Accéder à Blog">Blog</a><a href="#" class="h" id="theme-switch" title="Changer la couleur du fond"><span class="a q"></span><span class="a r"></span></a></div><div class="C"><p>#debian</p><p>#bitcoind</p><p>#bitcoin-cli</p></div><div class="I"><div class="J"><p><a href="/articles/installer-un-noeud-lightning-network" target="_blank">Dans l&#x27;article précédent</a> j&#x27;ai écrit au sujet de l&#x27;installation d&#x27;un nœud Bitcoin Lightning Network avec un Raspberry Pi. Ce dernier est sommaire et va à l&#x27;essentiel. Dans cet article il va s&#x27;agir d&#x27;optimiser la configuration du Raspberry Pi afin d&#x27;améliorer sa sécurité et rendre l&#x27;administration moins laborieuse.</p></div><div class="K"><h2>Sommaire</h2><div class="L"><a href="#fixer-ladresse-ip-locale-du-n%C5%93ud">Fixer l&#x27;adresse IP locale du nœud</a></div><div class="L"><a href="#s%C3%A9curiser-les-acc%C3%A8s-distants-ssh">Sécuriser les accès distants SSH</a></div><div class="L"><a href="#enregistrer-votre-cl%C3%A9-pour-les-connexions-futures">Enregistrer votre clé pour les connexions futures</a></div><div class="L"><a href="#ajouter-une-couche-suppl%C3%A9mentaire--lauthentification-ssh">Ajouter une couche supplémentaire à l&#x27;authentification SSH</a></div><div class="L"><a href="#activer-le-red%C3%A9marrage-automatique-des-services">Activer le redémarrage automatique des services</a><div><div class=""><a href="#bitcoind">bitcoind</a></div><div class=""><a href="#lnd">lnd</a></div></div></div></div></div><p><em>Notez que tout ce qui va suivre devra se faire avec l’utilisateur administrateur. Pour s’y connecter tapez une fois <code>su root</code> puis tapez son mot de passe.</em></p><h2 id="fixer-ladresse-ip-locale-du-n%C5%93ud" class="B"><a href="#fixer-ladresse-ip-locale-du-n%C5%93ud" class="c">§</a>Fixer l’adresse IP locale du nœud</h2><p><em>Ce qui suit s’applique qu’aux connexions réseau filaire et non Wifi</em></p><p>Votre nœud possède une adresse IP locale afin d’être accéssible dans votre réseau, c’est d’ailleurs grâce à cette dernière que vous pouvez y accéder avec SSH. Cependant il est fort probable que son adressage se fasse dynamiquement par défaut, par conséquent l’adresse de votre Raspberry pourrait changer. Il est préférable d’éviter cette inconvenance alors on va forcer une adresse IP statique.</p><p>Ouvrez le fichiers de configuration DHCP en tapant <code>nano /etc/dhcpcd.conf</code>, ajoutez à la fin du fichier ces informations :</p><pre><code>interface eth0
static ip_address=192.168.1.42/24 # C&#x27;est l&#x27;IP qu&#x27;aura la machine
static routers=&lt;Votre passerelle&gt; # Passerelle, explications plus bas
static domain_name_servers=&lt;Votre passerelle&gt; 8.8.8.8
</code></pre><p>Ici vous allez devoir faire un travail d’enquête pour connaître votre réseau et savoir quelle est la passerelle. Suivez le terminal ci-dessous :</p><div class="M"><div class="Q"><div class="R"><div class="N -O"></div><div class="N O"></div><div class="N P"></div></div><p class="S">Trouver l&#x27;adresse IP de la passerelle</p></div><div class="T"><div class="U"><span class="V">pi@raspberrypi:~ $</span><span class="-M cliboard-action-selector" data-value="gbbenec5pb_0">📋</span><span id="gbbenec5pb_0">ip route</span><span id="gbbenec5pb_0_copy-result" class="-N">C&#x27;est copié !</span><div>default via <span class="W">192.168.1.1</span> dev eth0 src 192.168.1.42 metric 202</div><div>192.168.1.0<span class="W">/24</span> dev eth0 proto kernel scope link src 192.168.1.42 metric 202</div></div></div></div><p>Trouvé ! <code>192.168.1.1</code> est la passerelle de mon réseau, c’est ce que vous devez mettre dans la configuration DHCP plus haut. Notez également le <code>/24</code> qui est un masque de réseau et que vous devez aussi utiliser dans votre configuration DHCP.</p><blockquote><p>Sans entrer dans les détails le masque <code>/24</code> (ou <code>/n</code>) est ce qui va déterminer la plage d’adresses disponibles. Avec une adresse type <code>192.168.1.0/24</code> vous avez 254 adresses disponibles allant de <code>192.168.1.1</code> à <code>192.168.1.254</code>. C’est important à considérer car cela signifie que vous ne pouvez pas mettre n’importe quelle adresse, il est important de respecter le format. Pour être sûr de ne pas vous tromper, conservez les 3 premiers chiffres de l’IP et choisissez le dernier : <code>x.x.x.y</code> où “x” sont les valeurs de base de l’IP (<code>192.168.1</code> selon l’exemple) et “y” est une valeur choisie arbitrairement et comprise entre 1 et 254.</p></blockquote><p>Votre nœud a maintenant une IP statique.</p><h2 id="s%C3%A9curiser-les-acc%C3%A8s-distants-ssh" class="B"><a href="#s%C3%A9curiser-les-acc%C3%A8s-distants-ssh" class="c">§</a>Sécuriser les accès distants SSH</h2><p>SSH est un protocole de réseau qui vous permet de vous connecter à distance sur une machine grâce à un canal chiffré. Cela signifie que la machine distante exécute un service qui reçoit les connexions SSH, ce service s’appelle <code>sshd</code>. SSH en lui même est plutôt bien sécurisé, cependant il est possible de couvrir un peu mieux les accès.</p><p>Sans plus attendre trouvez le fichier en tapant <code>sudo nano /etc/ssh/sshd_config</code>.</p><p>Voyons quelles modifications vous pouvez apporter afin de mieux sécuriser les accès SSH. Vous noterez que la plupart des lignes sont commentées grâce au caractère ”#”, cela signifie juste que les lignes comportant ce symbole au début sont neutralisées, le travail consiste essentiellement à dé-neutraliser certaines lignes.</p><p><code>Port 2310</code> : Mettez le port que vous souhaitez, le changer est toujours une couche de sécurité peu coûteuse. Ici j’ai mis 2310.</p><p><code>LoginGraceTime 2m</code> : Limite le temps de connexion inactif à 2 minutes. Vous pouvez l’augmenter mais le plus bas le mieux.</p><p><code>StrictModes yes</code> : Assure les accès aux fichiers en fonction de l’utilisateur connecté.</p><p><code>PermitRootLogin no</code> : Mettez PermitRootLogin à <code>no</code>, cette option bloquera les connexions SSH à l’utilisateur administrateur du Raspberry. Si vous avez suivi <a href="/articles/installer-un-noeud-lightning-network" class="-P" target="_blank">l’installation que je recommande</a> vous avez un utilisateur nommé <code>bitcoin</code> qui a pour rôle d’administrer les services bitcoind et lnd. C’est sur ce dernier que vous vous connecterez via SSH et non sur l’utilisateur root.</p><p><code>MaxAuthTries 3</code> : Nombre d’essais pour se connecter via SSH limité à 3. Cela bloque les attaques par brute force automatisé.</p><p><code>MaxSessions 1</code> : Si vous êtes la seule personne à gérer votre machine, et que vous ne comptez pas créer plusieurs connexions SSH simultanées, alors limitez le nombre de sessions à 1. Il faut garder ce nombre le plus petit possible en fonction de vos besoins.</p><p><code>PubkeyAuthentication yes</code> : Cette option vous servira plus tard. Elle n’ajoute pas de sécurité supplémentaire, c’est une option qui vous facilitera l’accès à votre machine.</p><p>Tapez CTRL + O et CTRL + X; et enfin redémarrez SSHd afin d’appliquer ces modifications en tapant <code>sudo service sshd restart</code>.</p><h3 id="enregistrer-votre-cl%C3%A9-pour-les-connexions-futures" class="B"><a href="#enregistrer-votre-cl%C3%A9-pour-les-connexions-futures" class="c">§</a>Enregistrer votre clé pour les connexions futures</h3><p>Dans la configuration précédente vous aviez activé l’option PubkeyAuthentication, cette option va vous permettre d’enregistrer la clé publique de votre machine sur le Raspberry. Cela vous évitera de taper sans cesse le mot de passe de connexion.</p><p>Cela se passe en un commande. Suivez le terminal ci-dessous. Notez que cela doit se faire depuis votre machine locale (votre mac, votre pc, etc). Si vous êtes sur Windows vous n’aurez pas cette commande.</p><div class="M"><div class="Q"><div class="R"><div class="N -O"></div><div class="N O"></div><div class="N P"></div></div><p class="S">Enregistrer se clé publique SSH</p></div><div class="T"><div class="U"><span class="V">monpc@oumonmac:~ $</span><span class="-M cliboard-action-selector" data-value="g040hizs5n_0">📋</span><span id="g040hizs5n_0">ssh-copy-id -i ~/.ssh/id_rsa.pub bitcoin@192.168.1.42</span><span id="g040hizs5n_0_copy-result" class="-N">C&#x27;est copié !</span></div></div></div><p>Ensuite vous devrez taper le mot de passe de l’utilisateur “bitcoin”. Notez que l’IP <code>192.168.1.42</code> (<a href="/articles/installer-un-noeud-lightning-network#ifconfig" class="-P" target="_blank">comment trouver l’IP de mon nœud ?</a>) doit être l’IP de votre nœud distant. Cette action aura pour effet de recenser la clé publique de votre machine dans le Raspberry Pi, il vous reconnaîtra pour les connexions futures et ne vous demandera plus de mot de passe.</p><blockquote><p>Si vous êtes sur Windows en utilisant PuTTy, vous pouvez générer et trouver votre clé publique avec <a href="https://www.digitalocean.com/docs/droplets/how-to/add-ssh-keys/create-with-putty/" class="-P" target="_blank">PuTTyGen</a>. Copiez cette clé qui commence par “ssh-rsa” si vous l’avez créé avec le chiffrement RSA. Cliquez sur “Save private key” et enregistrez le fichier sur votre machine. Revenez sur PuTTy, sur le panneau de gauche trouvez “Connection / SSH / Auth” puis dans la section “Private key file for authentication” chargez le fichier de votre clé privée, c’est un fichier .ppk. Connectez vous à votre Raspberry en utilisant PuTTy. Une fois connecté tapez <code>sudo nano .ssh/authorized_keys</code> et collez la clé publique que vous aviez copié, puis sauvegardez le fichier. C’est terminé désormais votre Raspberry connaît votre clé publique et autorisera les connexions futures depuis votre machine Windows.</p></blockquote><h2 id="ajouter-une-couche-suppl%C3%A9mentaire--lauthentification-ssh" class="B"><a href="#ajouter-une-couche-suppl%C3%A9mentaire--lauthentification-ssh" class="c">§</a>Ajouter une couche supplémentaire à l’authentification SSH</h2><p>Pour l’instant il est toujours possible de forcer l’accès à votre nœud avec une attaque par dictionnaire, qui consiste à tester des millions de mot de passe jusqu’à trouver un accès. Il existe un service nommé <code>fail2ban</code> qui va permettre de protéger en limitant les tentatives de connexion.</p><p>Pour l’installer tapez <code>apt-get update &amp;&amp; apt-get install -y fail2ban</code>. Ensuite vous allez devoir configurer une chose si vous avez modifié le port SSH comme je l’ai montré <a href="#securiser-ssh">juste au dessus</a>. Cherchez le fichier de configuration de fail2ban <code>nano /etc/fail2ban/jail.d/defaults-debian.conf</code>. Voyez la section <code>[sshd]</code> mettez ce qui suit (si vous n’avez rien dans le fichier, ajoutez également ce qui suit) :</p><pre><code>[sshd]
enabled = true
port    = 2310 # Notez que c&#x27;est le port que j&#x27;ai mis plus haut dans sshd_config
</code></pre><p>Sauvegardez en tapant CTRL + O et CTRL + X pour fermer et enfin tapez <code>systemctl restart fail2ban</code>.</p><blockquote><p>fail2ban est un service polyvalent qui sécurise nombreuse authentifications, dont le service sshd et nous l’utilisons pour ça.</p></blockquote><h2 id="activer-le-red%C3%A9marrage-automatique-des-services" class="B"><a href="#activer-le-red%C3%A9marrage-automatique-des-services" class="c">§</a>Activer le redémarrage automatique des services</h2><p>Cette partie est cruciale. Si votre Raspberry est redémarré à cause d’une coupure de courant par exemple, il redémarrera… Mais il ne relancera pas bitcoind ni lnd. Ce qui aurait pour effet d’éteindre le service et vous obliger à intervenir pour qu’il persévère.</p><p>D’abord il va falloir faire en sorte que le disque soit toujours monté sur le dossier .bitcoin car c’est ce dernier qui recense la blockchain et bitcoind en a besoin. Le montage de disque ne se fait jamais automatiquement. Alors voilà comment configurer cela :</p><div class="M"><div class="Q"><div class="R"><div class="N -O"></div><div class="N O"></div><div class="N P"></div></div><p class="S">Activer l&#x27;automount</p></div><div class="T"><div class="U"><span class="V">pi@raspberry:~ $</span><span class="-M cliboard-action-selector" data-value="gqk1v2m7qm_0">📋</span><span id="gqk1v2m7qm_0">df -h</span><span id="gqk1v2m7qm_0_copy-result" class="-N">C&#x27;est copié !</span><div>Filesystem      Size  Used Avail Use% Mounted on</div><div>/dev/root        15G  5.6G  8.4G  40% /</div><div>devtmpfs        460M     0  460M   0% /dev</div><div>tmpfs           464M     0  464M   0% /dev/shm</div><div>tmpfs           464M   12M  452M   3% /run</div><div>tmpfs           5.0M  4.0K  5.0M   1% /run/lock</div><div>tmpfs           464M     0  464M   0% /sys/fs/cgroup</div><div>/dev/mmcblk0p1   44M   22M   22M  51% /boot</div><div><span class="W">/dev/sda        458G  253G  182G  59% /home/bitcoin/.bitcoin</span></div><div>tmpfs            93M     0   93M   0% /run/user/1001</div></div><div class="U"><span class="V">pi@raspberry:~ $</span><span class="-M cliboard-action-selector" data-value="gqk1v2m7qm_1">📋</span><span id="gqk1v2m7qm_1">echo &#x27;/dev/sda /home/bitcoin/.bitcoin ext4 defaults,noatime 0 0&#x27; &gt;&gt; /etc/fstab</span><span id="gqk1v2m7qm_1_copy-result" class="-N">C&#x27;est copié !</span></div></div></div><p>Soyez vigilant ici. J’ai surligné mon montage actuel qui est <code>/dev/sda</code> monté sur <code>/home/bitcoin/.bitcoin</code>, vous devez mettre ce chemin dans le <code>echo</code> en dessous. Notez également l’annotation <code>ext4</code> qui est le système de fichier que j’ai choisi lorsque j’avais formaté le disque. Si vous avez un doute suivez le terminal ci-dessous</p><div class="M"><div class="Q"><div class="R"><div class="N -O"></div><div class="N O"></div><div class="N P"></div></div><p class="S">Trouver le système de fichier d&#x27;un disque</p></div><div class="T"><div class="U"><span class="V">pi@raspberry:~ $</span><span class="-M cliboard-action-selector" data-value="grq8vuz3ki_0">📋</span><span id="grq8vuz3ki_0">file -sL /dev/sda</span><span id="grq8vuz3ki_0_copy-result" class="-N">C&#x27;est copié !</span><div>/dev/sda: Linux rev 1.0 <span class="W">ext4</span> filesystem data, UUID=a2a0ec66-f768-4cf0-9442-6c2878ab60e1, volume name BLOCK-STORAGE (needs journal recovery) (extents) (64bit) (large files) (huge files)</div></div></div></div><p>Où <code>/dev/sda</code> est mon disque à monter. On voit en surligné <code>ext4</code> qui est le système de fichier.</p><h3 id="bitcoind" class="B"><a href="#bitcoind" class="c">§</a>bitcoind</h3><p>Le redémarrage automatique d’un service sur Linux se fait toujours de la même manière, il faut écrire le service. Et pour ce faire tapez <code>nano /etc/systemd/system/bitcoind.service</code> et entrez la configuration suivante :</p><pre><code>[Unit]
Description=Bitcoin daemon
After=network.target

[Service]
ExecStartPre=/bin/sh -c &#x27;sleep 30&#x27;
ExecStart=/usr/local/bin/bitcoind -daemon -conf=/home/bitcoin/.bitcoin/bitcoin.conf -pid=/home/bitcoin/.bitcoin/bitcoind.pid # Mettez le chemin vers votre dossier .bitcoin
PIDFile=/home/bitcoin/.bitcoin/bitcoind.pid # Mettez le chemin vers votre dossier .bitcoin
User=bitcoin # Votre utilisateur qui gère le service
Group=bitcoin # Votre groupe qui gère le service
Type=forking
KillMode=process
Restart=always
TimeoutSec=120
RestartSec=30

[Install]
WantedBy=multi-user.target
</code></pre><p>CTRL + O et CTRL + X pour enregistrer et quitter puis tapez <code>systemctl enable bitcoind</code>. La machine est lancée, le service bitcoind démarrera au lancement du Raspberry.</p><h3 id="lnd" class="B"><a href="#lnd" class="c">§</a>lnd</h3><p>Encore une fois, il faut créer un service pour le service de lightning network, tapez <code>nano /etc/systemd/system/lnd.service</code> et voilà la configuration que je recommande :</p><pre><code>[Unit]
Description=LND
Wants=bitcoind.service
After=bticoind.service # Il démarre après bitcoind

[Service]
ExecStart=/usr/local/bin/lnd

User=bitcoin # Votre utilisateur qui gère le service
Group=bitcoin # Votre utilisateur qui gère le service
Type=simple
KillMode=process
LimitNOFILE=128000
TimeoutSec=300
Restart=always
RestartSec=120

[Install]
WantedBy=multi-user.target
</code></pre><p>Et enfin pour l’activer <code>systemctl enable lnd</code>.</p><hr/><p>Félicitations, votre Raspberry est autonome, il relancera les services en cas de redémarrage inopiné, sans votre aide, tout seul comme un grand.</p><p>Dans un article futur on va voir comment on peut administrer son nœud avec une interface graphique !</p><span class="G">Modifié le  <time dateTime="2019-04-24T00:00:00.000Z">mercredi 24 avril 2019</time></span><section class="-d"><p><i>Cet article est sous license <a href="https://creativecommons.org/licenses/?lang=fr-FR" target="_blank">Creative Commons BY-NC-SA</a>. Il est ouvert à contribution en vous rendant sur ce lien : <a href="https://github.com/Chaine-de-Blocs/blocs.fr/blob/master/posts/2019-04-24-configurer-un-noeud-lightning-network.mdx" target="_blank">Configurer son nœud Bitcoin Lightning Network</a></i></p></section><script type="text/javascript" data-isso="https://isso.blocs.fr/" src="//isso.blocs.fr/js/embed.min.js" data-isso-css="true" data-isso-lang="fr" data-isso-reply-notifications="true" async=""></script><div class="-b"><h2>Commentaires</h2><p><i>(Le format <a href="https://www.christopheducamp.com/2014/09/18/love-markdown/" target="_blank">Markdown</a> est accepté)</i></p><section id="isso-thread"></section></div></body></html>