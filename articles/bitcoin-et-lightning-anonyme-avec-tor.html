<!DOCTYPE HTML><html lang="fr" prefix="og: http://ogp.me/ns#"><head><title>Servir Bitcoin et Lightning Network en étant anonyme avec Tor</title><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="theme-color" content="#0070FC"/><meta name="author" content="Jonathan Serra"/><meta property="og:url" content="https://blocs.fr"/><meta property="og:title" content="Servir Bitcoin et Lightning Network en étant anonyme avec Tor"/><meta property="og:description" content="Vous avez un nœud Bitcoin et Lightning Network, vous participez à la décentralisation du réseau, bravo ! Cependant il réside un point noir, en particulier si votre noeud est localisé chez vous ou votre bureau... En connaissant votre adresse IP, publiée par le noeud, il est possible de vous localiser. On remédie à cela avec Tor."/><meta name="description" content="Vous avez un nœud Bitcoin et Lightning Network, vous participez à la décentralisation du réseau, bravo ! Cependant il réside un point noir, en particulier si votre noeud est localisé chez vous ou votre bureau... En connaissant votre adresse IP, publiée par le noeud, il est possible de vous localiser. On remédie à cela avec Tor."/><meta property="og:image" content="/res/5d444598.png"/><meta property="og:image:alt" content="Installer un noeud Bitcoin-Comment fonctionne bitcoin-Installer Bitcoin"/><meta property="og:type" content="blog"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@_blocs"/><meta name="twitter:creator" content="@_blocs"/><meta property="article:author" content="Jonathan Serra"/><script defer="">const storageKey="blocs-data-theme";document.addEventListener("DOMContentLoaded",(function(){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;let t=window.localStorage.getItem(storageKey);t||(t=e?"dark":"light");const a=document.querySelector("#theme-switch");a&&(activateTheme(t,a),a.addEventListener("click",(()=>{switch(t){case"dark":t="light";break;default:t="dark"}window.localStorage.setItem(storageKey,t),activateTheme(t,a)})))}));const activateTheme=(e,t)=>{const a=t.childNodes[0],c=t.childNodes[1];switch(e){case"light":c.style.display="block",a.style.display="none";break;case"dark":default:c.style.display="none",a.style.display="block"}document.documentElement.setAttribute("data-theme",e)};</script><script src="/res/1699ad49.js" defer=""></script><style>@keyframes ripple{to{transform:scale(4);opacity:0}}@font-face{font-family:Inter;font-weight:100 900;font-display:swap;font-style:normal;font-named-instance:"Regular";src:url(/res/541fae2e.woff2);font-display:fallback}@font-face{font-family:Inter;font-weight:100 900;font-display:swap;font-style:italic;font-named-instance:"Regular";src:url(/res/1517082.woff2);font-display:fallback}@font-face{font-family:'icons';font-display:swap;src:url(/res/31819284.woff2);font-weight:400;font-style:normal;font-display:fallback}.a:before,[class*=" icon-"]:before,[class^=icon-]:before{font-family:"icons";font-style:normal;font-weight:400;speak:never;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*,::after,::before{box-sizing:border-box}*{font-weight:var(--b)}@supports (font-variation-settings:"wght" 400){*{font-weight:inherit;font-variation-settings:"wght" var(--b)}}:root{--a:#0070FC;--c:#FBE016;--d:#9e9e9e;--e:white;--f:black;--g:#000F26;--h:#eee;--i:12px;--j:12px}::selection{background-color:var(--a);color:#fff}[data-theme=light]{--e:#111;--c:#E32B89;--d:#667;--f:#fafafa;--g:#fcfcfe;--h:#333}body{margin:var(--i) var(--j) 64px;font:18px/26px Inter,system-ui,-apple-system,sans-serif;color:var(--e);background:var(--g);line-height:28px;max-width:100%;overflow-x:hidden}a{text-decoration:none;color:var(--a)}.x .z>div a:hover,a:active,a:hover{text-decoration:underline}.b a span{font-size:26px}.c{float:left;margin-left:-24px}a:active,a:focus,a:hover{text-decoration:underline}.d{display:flex;padding-top:12px;margin:-12px calc(-1*var(--j)) 48px;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch}.d::after,.d::before{display:block;content:"";padding-right:var(--j)}.e,.f{flex:none;--b:700}.e{display:block;font-size:24px;line-height:18px;letter-spacing:-1px;text-transform:lowercase;border-top:4px solid;padding:6px 4px 0 0}a.e{color:currentColor;text-decoration:none}.f{margin:0 0 0 24px;font-size:6px;line-height:10px;letter-spacing:1px;text-transform:uppercase;width:0}.g{margin-left:auto}.h{flex:none;display:block;margin:10px 24px 0 0;font-size:14px;color:var(--e);--b:600;line-height:18px}.h:last-child{margin-right:0}a.i,a.i.j{color:var(--e)}a.i{display:block;cursor:pointer;font-size:16px;min-width:125px;margin:0 auto;padding:13px;text-decoration:none;border:1px solid var(--e);border-radius:6px;background-color:transparent;outline:0;height:44px;max-height:44px;min-height:44px;line-height:14px;transform:translate(0,0);transition:all;transition-duration:123ms}a.i.j{background-color:var(--a);border-color:var(--a)}#isso-thread input[type=button]:hover,#isso-thread input[type=submit]:hover,a.i:hover{transform:translate(-2px,-2px);box-shadow:2px 2px 1px var(--h)}#isso-thread input[type=button]:active,#isso-thread input[type=submit]:active,a.i:active{transform:translate(0,0);box-shadow:inset 0 0 7px var(--h)}.k>span{position:absolute;border-radius:50%;transform:scale(0);animation:ripple 400ms linear;background-color:rgba(255,255,255,.5)}@media (min-width:768px){:root{--j:64px}}@media (min-width:1024px){:root{--j:128px}}.l:before{content:'\f16d'}.m:before{content:'\f300'}.o:before{content:'\f167'}.n:before{content:'\f30c'}.p:before{content:'\f2c6'}.q:before{content:'\E800'}.r:before{content:'\F186'}:root{--j:max(12px, (100vw - var(--k)) / 2);--k:800px}h1{margin:48px 0 32px;font-size:36px;line-height:48px;letter-spacing:-.8px}h2,h3{margin:42px 0 18px}h1,h2{font-weight:700}h2{font-size:26px;line-height:34px;letter-spacing:-.3px}h3{font-size:22px;line-height:30px;letter-spacing:-.18px}p{margin:18px 0}p>code{word-break:break-all}blockquote code,em>code{font-style:normal}.s a,h3,strong{font-weight:600}ul.s{margin:24px 0;padding-left:32px;margin-left:calc(-32*min(max(var(--j) - 32px,0px),1px))}.s a{color:var(--e)}.s li{overflow:hidden;display:flex;flex-direction:row;position:relative;list-style:none;margin:2px 0 30px;border-radius:8px}.s picture{margin-top:5px;margin-right:20px}.s picture *{border-radius:5px}#isso-thread #isso-root .P,.t,.x .z>div{margin:0}.u{font-size:16px;margin:5px 0}i{font-size:14px}blockquote{line-height:32px;font-weight:300;font-style:italic;color:var(--d)}table{margin:24px;border-collapse:separate;border-spacing:12px 0}thead th{border-bottom:var(--l) solid;--b:600;text-align:left}code,pre code{background-color:var(--f)}code{font-size:.9em;font-family:monospace;padding:1px 5px;border:1px dotted var(--c);border-radius:4px}pre code{display:block;width:100vw;margin:48px calc(-1*var(--j));padding:18px var(--j);border-width:0;border-radius:0;overflow-x:scroll}video{display:block;max-width:100%;margin:32px auto}iframe{width:calc(var(--m)*1);height:calc(var(--m)*.66);border:1px solid rgba(0,0,0,.1);--m:calc(100vw - 2 * var(--j))}.v{color:#9e9e9e}.w{cursor:pointer}.x{display:flex;flex-wrap:wrap-reverse}.x .y>p{padding-top:0;margin-top:0}.x .z .A{margin-bottom:7px}.x .y{flex:1;margin-right:15px;width:400px}.x .z{padding:17px;background-color:var(--f);border-radius:4px;border-width:1px;border-color:var(--e);border-style:solid;overflow:hidden;max-width:350px}.x .z h2{margin:0 0 10px}.x .z>div div{margin-left:20px}.x .z>div a{display:block;text-decoration:none}.B{box-shadow:7px 10px 15px rgba(10,10,10,.2)}.B .C{height:10px;width:10px;border-radius:50%;border:1px solid #000;position:relative;top:6px;left:6px;background-color:#ff3b47;border-color:#9d252b;display:inline-block;vertical-align:top}.C.D{left:11px;background-color:#ffc100;border-color:#9d802c}.C.E{left:16px;background-color:#00d742;border-color:#049931}.B .F{position:relative;width:100%;height:25px;background-color:#bbb;margin:0 auto;border-top-right-radius:5px;border-top-left-radius:5px}.B .G,.B .H{display:inline-block}.B .G{position:absolute}.B .H{color:#333;width:100%;padding:0;margin:0;text-align:center;font-size:12px;font-weight:700;vertical-align:top;line-height:25px}.B .I{background-color:#000;color:#fff;box-sizing:border-box;width:100%;margin:0 auto;padding:20px;border-bottom-left-radius:5px;border-bottom-right-radius:5px;font-size:16px}.B .J{font-family:monospace!important;padding:0;margin:0}.B .K{color:var(--c);font-weight:700;margin-right:7px}.B .L{background-color:#fff}.B i{color:#666}#isso-thread h4{display:none}#isso-thread input[type=button],#isso-thread input[type=submit]{cursor:pointer;font-size:16px;width:125px;margin:0 auto;color:var(--e);padding:13px;text-decoration:none;border:1px solid #fff;border-radius:6px;background-color:transparent;outline:0;height:44px;max-height:44px;min-height:44px;line-height:14px;transform:translate(0,0);transition:all;transition-duration:123ms}#isso-thread input[type=submit]{background-color:var(--a);border-color:var(--a);color:#fff}#isso-thread input[type=checkbox]{margin-right:6px}#isso-thread>div>div>div>div,.B .L{color:#000}#isso-thread label{color:#fff}#isso-thread h1,#isso-thread h2,#isso-thread h3,#isso-thread h4,#isso-thread h5,#isso-thread h6{margin:0;line-height:1em}#isso-thread h1{font-size:2em}#isso-thread h2{font-size:1.6}#isso-thread h3{font-size:1.2}#isso-thread #isso-root b,#isso-thread #isso-root h1,#isso-thread #isso-root h2,#isso-thread #isso-root h3,#isso-thread #isso-root i,#isso-thread #isso-root p,#isso-thread #isso-root strong,#isso-thread code,#isso-thread section label,.x .z h2{color:var(--e)}#isso-thread input[type=email],#isso-thread input[type=text]{margin-bottom:15px;padding:10px 0 10px 10px;background-color:transparent;border:0;border-bottom:1px solid var(--e);border-radius:0;outline-color:var(--h);color:var(--e);margin-right:10px}#isso-thread .M::placeholder,#isso-thread input[type=email]::placeholder,#isso-thread input[type=text]::placeholder{color:var(--d)}#isso-thread .M::active,#isso-thread .M:focus,#isso-thread input[type=email]:active,#isso-thread input[type=email]:focus,#isso-thread input[type=text]:active,#isso-thread input[type=text]:focus{border-color:var(--a)!important}#isso-thread input[name=website]{display:none}#isso-thread .N{margin-top:30px}#isso-thread .N>.O{padding-right:15px}#isso-thread preview{background:0 0;border:0;box-shadow:none}#isso-thread>div:first-of-type>div:first-of-type>div:first-of-type>div:first-of-type{min-height:100px!important;font-size:14px}#isso-thread>div:first-of-type>div:first-of-type>div:first-of-type>div:first-of-type>div:first-of-type{max-height:1.5em}#isso-thread #isso-root .Q{color:#fff!important}.R h2{margin-bottom:0;padding-bottom:0}.R p{margin-top:0}.R i{font-size:14px}@media (min-width:768px){a,p>code{word-break:initial}}@media (max-width:484px){.s li{flex-direction:column}.s li img{width:100%}.s{padding:0 15px!important}.s picture{margin-bottom:10px;margin-right:0}.c{margin-left:0;margin-right:8px}}.V,.W{color:#a0a1a7;font-style:italic}.X,.Y,.Z{color:#a626a4}.-a,.-b,.-c,.-d,._{color:#e45649}.-e{color:#0184bb}.-f,.-g,.-h,.-i,.-j{color:#50a14f}.-k,.-l .-m{color:#c18401}.-n,.-o,.-p,.-q,.-r,.-s,.-t,.-u{color:#986801}.-m,.-v,.-w,.-x,.-y,.-z{color:#4078f2}.-A{font-style:italic}.-B{font-weight:700}.-x{text-decoration:underline}@media (prefers-color-scheme:dark){.V,.W{color:#5c6370;font-style:italic}.X,.Y,.Z{color:#c678dd}.-a,.-b,.-c,.-d,._{color:#e06c75}.-e{color:#56b6c2}.-f,.-g,.-h,.-i,.-j{color:#98c379}.-k,.-l .-m{color:#e6c07b}.-n,.-o,.-p,.-q,.-r,.-s,.-t,.-u{color:#d19a66}.-m,.-v,.-w,.-x,.-y,.-z{color:#61aeee}.-A{font-style:italic}.-B{font-weight:700}.-x{text-decoration:underline}}.-C{padding:0 8px;vertical-align:top;cursor:pointer;color:var(--a)}.-C:hover{text-decoration:underline}.-D{position:absolute;opacity:0;color:#fff;font-weight:700;background-color:var(--a);padding:5px 10px;margin-left:10px;border-radius:6px;font-size:14px;transition:123ms}</style><script defer="">document.documentElement.style.setProperty("--l",1/(window.devicePixelRatio||1)+"px");</script></head><body><div class="d"><a href="/" class="e">Blocs<br/>.fr</a><div class="f">Site</div><a href="/" class="h" title="Accéder à Home">Home</a><div class="f g">Cool</div><a href="/blog" class="h" title="Accéder à Blog">Blog</a><a href="#" class="h" id="theme-switch" title="Changer la couleur du fond"><span class="a q"></span><span class="a r"></span></a></div><div class="x"><div class="y"><p>Vous avez un nœud Bitcoin et Lightning Network, vous participez à la décentralisation du réseau, bravo ! Cependant il réside un point noir, en particulier si votre noeud est localisé chez vous ou votre bureau... En connaissant votre adresse IP, publiée par le nœud, il est possible de vous localiser. C&#x27;est sensible dans le cas où vous y mettez pour l&#x27;équivalent de milliers d&#x27;euros en bitcoins, une personne mal intentionnée pourrait vous pirater voire vous cambrioler. Heureusement, grâce à Tor vous allez pouvoir cacher tout cela en un temps record</p></div><div class="z"><h2>Sommaire</h2><div class="A"><a href="#quest-ce-que-tor--pourquoi-tor-">Qu&#x27;est ce que Tor ? Pourquoi Tor ?</a></div><div class="A"><a href="#installer-et-activer-tor">Installer et activer Tor</a></div><div class="A"><a href="#configurer-tor">Configurer Tor</a></div><div class="A"><a href="#connecter-votre-bitcoin--tor">Connecter votre Bitcoin à Tor</a></div><div class="A"><a href="#connecter-votre-lightning--tor">Connecter votre Lightning à Tor</a><div><div class=""><a href="#g%C3%A9rer-les-droits-avec-tor">Gérer les droits avec Tor</a></div></div></div></div></div><p><em>Ce guide est basé sur une installation avec <code>bitcoind</code> et <code>lnd</code> sur un Debian 9 Stretch  Lite, sur n’importe quelle version Debian 9 ce guide sera fonctionnel.</em></p><h2 id="quest-ce-que-tor--pourquoi-tor-" class="T"><a href="#quest-ce-que-tor--pourquoi-tor-" class="c">§</a>Qu’est ce que Tor ? Pourquoi Tor ?</h2><p>Vous connaissez peut-être Tor indirectement en citant le « Deep Web », mais c’est bien plus que cela. Tor est un logiciel libre qui permet de brouiller les communications Internet (TCP) en construisant un circuit de routage IP. En d’autres termes un émetteur communique avec un récepteur en passant par un chemin incompréhensible, la communication devient intraçable d’un point de vue extérieur.</p><p>Autant vous dire que Tor est la solution propice à anonymiser les communications de votre nœud Bitcoin.</p><blockquote><p>Tor tord le chemin.</p></blockquote><h2 id="installer-et-activer-tor" class="T"><a href="#installer-et-activer-tor" class="c">§</a>Installer et activer Tor</h2><p>On va travailler avec le terminale de commandes, si vous avez la version Lite, vous n’avez que cela sous la main en principe.</p><p>Installer Tor se fait avec la commande <code>apt update &amp;&amp; apt install tor</code>, on met à jour <code>apt</code> pour être sûr de télécharger la dernière version des dépendances.</p><p>Une fois installé activez le service en tapant <code>systemctl enable tor</code> et <code>systemctl start tor</code>.</p><h2 id="configurer-tor" class="T"><a href="#configurer-tor" class="c">§</a>Configurer Tor</h2><p>On a installé Tor, nous allons le configurer en prévision des usages avec <code>lnd</code> et <code>bitcoind</code>.</p><p>La configuration de Tor se trouve dans le chemin <code>/etc/tor/torrc</code> où <code>torrc</code> est un fichier de configuration. Connectez-vous en <code>root</code> pour le modifier avec <code>su root</code>, puis tapez <code>vim /etc/tor/torrc</code> ou <code>nano /etc/tor/torrc</code> si vous préférez <code>nano</code> pour éditer un fichier. Je vous montre les configurations à décommenter (en retirant le # au début de chaque ligne concernée).</p><pre><code>ControlPort 9051

CookieAuthentication 1

HiddenServiceDir /var/lib/tor/bitcoin/ # Emplacement du dossier de votre routage
HiddenServicePort 8333 127.0.0.1:8333 # Routage bitcoin (8333 est le port mainnet de Bitcoin)
HiddenServicePort 8332 [::1]:8332 # Routage bitcoin ipv6
</code></pre><p>Modifications faites, tapez <code>systemctl restart tor</code> pour redémarrer Tor afin qu’il prenne en compte vos modifications.</p><p>Et enfin pour voir si Tor est fonctionnel, observez le avec la commande <code>systemctl status tor@default</code>, vous devriez avec quelque chose comme suit :</p><div class="B"><div class="F"><div class="G"><div class="C -E"></div><div class="C D"></div><div class="C E"></div></div><p class="H">Voir le status de Tor</p></div><div class="I"><div class="J"><span class="K">root@raspberry:~ $</span><span class="-C cliboard-action-selector" data-value="g7ym2bydk3_0">📋</span><span id="g7ym2bydk3_0">systemctl status tor</span><span id="g7ym2bydk3_0_copy-result" class="-D">C&#x27;est copié !</span><div>● tor@default.service - Anonymizing overlay network for TCP</div><div>Loaded: loaded (/lib/systemd/system/tor@default.service; static; vendor preset: enabled)</div><div>Active: active (running) since Wed 2020-01-01 10:09:09 UTC; 7h ago</div><div>Process: 1805 ExecReload=/bin/kill -HUP ${MAINPID} (code=exited, status=0/SUCCESS)</div><div>Process: 2259 ExecStartPre=/usr/bin/tor --defaults-torrc /usr/share/tor/tor-service-defaults-torrc -f /etc/tor/torrc --RunAsDaemon 0 --verify-config (code=exited, status=0/SUCCESS</div><div>Process: 2257 ExecStartPre=/usr/bin/install -Z -m 02755 -o debian-tor -g debian-tor -d /var/run/tor (code=exited, status=0/SUCCESS)</div><div>Main PID: 2262 (tor)</div><div>CGroup: /system.slice/system-tor.slice/tor@default.service</div><div>&nbsp;&nbsp;&nbsp;└─2262 /usr/bin/tor --defaults-torrc /usr/share/tor/tor-service-defaults-torrc -f /etc/tor/torrc --RunAsDaemon 0</div><div></div><div>Jan 01 10:09:05 raspberrypi tor[2259]: Jan 01 10:09:05.113 [notice] Read configuration file /usr/share/tor/tor-service-defaults-torrc.</div><div>Jan 01 10:09:05 raspberrypi tor[2259]: Jan 01 10:09:05.113 [notice] Read configuration file /etc/tor/torrc.</div><div>Jan 01 10:09:05 raspberrypi tor[2259]: Configuration was valid</div><div>Jan 01 10:09:05 raspberrypi tor[2262]: Jan 01 10:09:05.979 [notice] Tor 0.2.9.16 (git-9ef571339967c1e5) running on Linux with Libevent 2.0.21-stable, OpenSSL 1.1.0j and Zlib 1.2.8.</div><div>Jan 01 10:09:05 raspberrypi tor[2262]: Jan 01 10:09:05.979 [notice] Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warn</div><div>Jan 01 10:09:05 raspberrypi tor[2262]: Jan 01 10:09:05.979 [notice] Read configuration file /usr/share/tor/tor-service-defaults-torrc.</div><div>Jan 01 10:09:05 raspberrypi tor[2262]: Jan 01 10:09:05.979 [notice] Read configuration file /etc/tor/torrc.</div><div>Jan 01 10:09:05 raspberrypi tor[2262]: Jan 01 10:09:05.995 [notice] Opening Socks listener on 127.0.0.1:9050</div><div>Jan 01 10:09:05 raspberrypi tor[2262]: Jan 01 10:09:05.995 [notice] Opening Control listener on 127.0.0.1:9051</div><div>Jan 01 10:09:09 raspberrypi systemd[1]: Started Anonymizing overlay network for TCP.</div></div></div></div><p>Si votre service Tor n’est pas actif, vous trouverez des informations en tapant <code>journalctl -u tor@default</code>.</p><h2 id="connecter-votre-bitcoin--tor" class="T"><a href="#connecter-votre-bitcoin--tor" class="c">§</a>Connecter votre Bitcoin à Tor</h2><p>Cette configuration fonctionne avec <code>bitcoind</code> en version <code>0.19.0.1</code>, dans mon nœud j’utilise l’utilisateur <code>bitcoin</code> pour gérer ce service, je vous déconseille d’utiliser <code>root</code>.</p><p>Avant de commencer vous allez devoir chercher votre nom de domaine Tor en tapant ce qui suit :</p><div class="B"><div class="F"><div class="G"><div class="C -E"></div><div class="C D"></div><div class="C E"></div></div><p class="H">Voir le status de Tor</p></div><div class="I"><div class="J"><span class="K">bitcoin@raspberry:~ $</span><span class="-C cliboard-action-selector" data-value="gghiwnj1pk_0">📋</span><span id="gghiwnj1pk_0">cat /var/lib/tor/bitcoin/hostname</span><span id="gghiwnj1pk_0_copy-result" class="-D">C&#x27;est copié !</span><div>blocsiq5epwbye47.onion</div></div></div></div><p><code>blocsiq5epwbye47.onion</code> est mon nom de domaine (hostname).</p><blockquote><p>Si vous voulez savoir comment avoir un domaine qui commence par un mot ou pseudo comme ici “blocs”, laissez un commentaire plus bas.</p></blockquote><p>Pour configurer Bitcoin vous allez modifier <code>.bitcoin/bitcoin.conf</code> avec les informations suivantes :</p><pre><code># Vos configurations
# ...
# Ajoutez ou modifiez ce qui suit

proxy=127.0.0.1:9050 # Proxy sur le service Tor
externalip=blocsiq5epwbye47.onion # à remplacer par votre hostname, c&#x27;est l&#x27;adresse affichée aux autres nœuds du réseau
</code></pre><p>Redémarrez Bitcoin en tapant <code>bitcoin-cli stop &amp;&amp; bitcoind</code>.</p><p>Félicitations votre nœud est désormais sur le réseau Tor. Il ne vous reste plus qu’à faire de même sur LND afin d’anonymiser nos échanges sur le réseau Lightning Network.</p><h2 id="connecter-votre-lightning--tor" class="T"><a href="#connecter-votre-lightning--tor" class="c">§</a>Connecter votre Lightning à Tor</h2><p>La configuration de <code>lnd</code> est un peu différente de Bitcoin. Sans plus attendre ouvrez <code>.lnd/lnd.conf</code> et ajoutez ces différentes configurations :</p><pre><code># Vos configurations
# ...
# Ajoutez ou modifiez ce qui suit

listen=localhost # Important pour éviter d&#x27;ouvrir votre IP
externalip=blocsiq5epwbye47.onion # Votre hostname Tor
nat=false # A désactiver pour éviter d&#x27;associer votre adresse IP à votre nœud

[tor]
tor.active=1
tor.socks=9050
tor.privatekeypath=/var/lib/tor/bitcoin/private_key
</code></pre><p>Redémarrez votre <code>lnd</code> en tapant <code>lncli stop</code> et <code>lnd</code> pour lancer le service.</p><p>Il se peut que vous ayez une erreur de droit relative à Tor. Dans la partie suivante on voit comment la solutionner.</p><h3 id="g%C3%A9rer-les-droits-avec-tor" class="T"><a href="#g%C3%A9rer-les-droits-avec-tor" class="c">§</a>Gérer les droits avec Tor</h3><p>Vous devez donner accès à différents fichiers de Tor à l’utilisateur qui gère votre <code>lnd</code>, dans mon cas mon utilisateur est <code>bitcoin</code>.</p><p>Tapez la commande <code>chmod -R 0750 /var/lib/tor</code>. Cela va donner accès en lecture au groupe <code>debian-tor</code> sur le dossier <code>/var/lib/tor</code>.</p><p>Maintenant ajoutez l’utilisateur <code>bitcoin</code> au groupe <code>debian-tor</code> en tapant <code>usermod -a -G debian-tor bitcoin</code> en étant connecté sur <code>su root</code>.</p><blockquote><p>Tor est bien conçu, il ne nous permet pas d’appliquer les droits qu’on veut à ses dossiers pour limiter de trop les ouvrir. Tapez <code>journalctl -u tor@default</code>, si les dernières lignes parlent d’une erreur, cela signifie que votre Tor n’est plus en route. C’est un général dû à une mauvaise configuration (mauvais droits sur les dossiers relatifs à Tor, mauvaises configuration dans <code>torrc</code>, etc.)</p></blockquote><hr/><p>A partir d’ici votre nœud est connecté au réseau en passant par Tor ! Il est toujours intéressant d’observer si tout est bien cadré par Tor afin de ne pas avoir de fuite d’IP. Tapez la commande du terminal ci-dessous :</p><div class="B"><div class="F"><div class="G"><div class="C -E"></div><div class="C D"></div><div class="C E"></div></div><p class="H">Observer les ports d&#x27;écoute</p></div><div class="I"><div class="J"><span class="K">root@raspberry:~ $</span><span class="-C cliboard-action-selector" data-value="gbvks7zus8_0">📋</span><span id="gbvks7zus8_0">netstat -tulpn</span><span id="gbvks7zus8_0_copy-result" class="-D">C&#x27;est copié !</span><div>(Not all processes could be identified, non-owned process info</div><div>will not be shown, you would have to be root to see it all.)</div><div>Active Internet connections (only servers)</div><div>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</div><div>tcp        0      0 127.0.0.1:9735          0.0.0.0:*               LISTEN      2043/lnd</div><div>tcp        0      0 127.0.0.1:28332         0.0.0.0:*               LISTEN      653/bitcoind</div><div>tcp        0      0 127.0.0.1:8332          0.0.0.0:*               LISTEN      653/bitcoind</div><div>tcp        0      0 127.0.0.1:8333          0.0.0.0:*               LISTEN      653/bitcoind</div><div>tcp        0      0 127.0.0.1:28333         0.0.0.0:*               LISTEN      653/bitcoind</div><div>tcp        0      0 127.0.0.1:8080          0.0.0.0:*               LISTEN      2043/lnd</div><div>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -</div><div>tcp        0      0 127.0.0.1:10009         0.0.0.0:*               LISTEN      2043/lnd</div><div>tcp        0      0 127.0.0.1:9050          0.0.0.0:*               LISTEN      -</div><div>tcp        0      0 127.0.0.1:9051          0.0.0.0:*               LISTEN      -</div><div>tcp6       0      0 ::1:8332                :::*                    LISTEN      653/bitcoind</div><div>tcp6       0      0 :::80                   :::*                    LISTEN      -</div><div>tcp6       0      0 :::22                   :::*                    LISTEN      -</div><div>udp        0      0 0.0.0.0:48138           0.0.0.0:*                           -</div><div>udp        0      0 0.0.0.0:68              0.0.0.0:*                           -</div><div>udp        0      0 0.0.0.0:5353            0.0.0.0:*                           -</div><div>udp6       0      0 :::45175                :::*                                -</div><div>udp6       0      0 :::5353                 :::*                                -</div></div></div></div><p>Nous, ce qui nous intéresse ce sont <code>bitcoind</code> et <code>lnd</code>. On va passer tous les ports d’écoute en revue et comprendre si oui ou non ils sont “torrifiés” :</p><ul><li><code>lnd 9735</code> : C’est le port de LND, “torrifiée” avec le clé privée de votre Tor ;</li><li><code>bitcoind 28332</code> : C’est le port <a href="https://zeromq.org/" class="-F" target="_blank">ZMQ</a> de Bitcoin, il sert à la configuration et n’est pas distribué ;</li><li><code>bitcoind 8333</code> : C’est le port de <code>bitcoind</code> qui est caché via Tor (HiddenServicePort dans <code>/etc/tor/torrc</code>) ;</li><li><code>bitcoind 8332</code> : C’est le port JSON-RPC de <code>bitcoind</code>, nul besoin de le cacher avec Tor si vous ne le distribuez pas ;</li><li><code>bitcoind 8332 IPV6</code> : C’est le port ipv6 de <code>bitcoind</code> qui est caché via Tor (HiddenServicePort dans <code>/etc/tor/torrc</code>) ;</li></ul><p>Enfin pour voir si <code>lnd</code> a bien considéré vos modifications, tapez <code>lncli getinfo</code>, vous obtenez un JSON comme suit :</p><pre><code>{
    &quot;version&quot;: &quot;0.8.0-beta commit=v0.8.1-beta&quot;,
    &quot;identity_pubkey&quot;: &quot;03a2c34daf010b3501daf704b5a321e82e1631421b7ffa18dd49014967eda82dc9&quot;,
    &quot;alias&quot;: &quot;blocs.fr&quot;,
    &quot;color&quot;: &quot;#00aaff&quot;,
    &quot;num_pending_channels&quot;: 0,
    &quot;num_active_channels&quot;: 6,
    &quot;num_inactive_channels&quot;: 0,
    &quot;num_peers&quot;: 6,
    &quot;block_height&quot;: 610817,
    &quot;block_hash&quot;: &quot;0000000000000000000ff1cf20075afd0df2a52288edd20a7d1cd8a51ca3e32a&quot;,
    &quot;best_header_timestamp&quot;: 1577900732,
    &quot;synced_to_chain&quot;: true,
    &quot;synced_to_graph&quot;: true,
    &quot;testnet&quot;: false,
    &quot;chains&quot;: [
        {
            &quot;chain&quot;: &quot;bitcoin&quot;,
            &quot;network&quot;: &quot;mainnet&quot;
        }
    ],
    &quot;uris&quot;: [
        &quot;03a2c34daf010b3501daf704b5a321e82e1631421b7ffa18dd49014967eda82dc9@blocsiq5epwbye47.onion:9735&quot;
    ]
}
</code></pre><p>Intéressez vous à la partie d’en bas, <code>&quot;uris&quot;</code>, qui est une liste des adresses distribuées dans le réseau. Ici je n’ai qu’une adresse qui est un .onion, voir ce qui suit le ”@“. La partie de gauche est la clé publique de mon lnd.</p><blockquote><p>.onion est un nom de domaine exclusif au routage en oignon comme le fait Tor. Comme vous pouvez l’imaginer, c’est réellement une référence à la plante. Cela vient du routage qui recouvre le message de plusieurs couches, comme un oignon où le coeur est enrobé de plusieurs couches. <a href="https://www.youtube.com/watch?v=zjqw1VnuKLs" class="-F" target="_blank">MrBidouille en a fait une parfaite vidéo introductive</a>.</p></blockquote><p>Vérifications faites, vous êtes cachés, bravo !</p><p>Merci à <a href="https://twitter.com/clint_network">Clint</a> pour ses infos sur Tor et <a href="https://twitter.com/JohnOnChain">JohnOnChain</a> pour m’avoir aidé à la configuration de lnd avec Tor.</p><span class="v">Modifié le  <time dateTime="2020-01-01T00:00:00.000Z">mercredi 1 janvier 2020</time></span><section class="U"><p><i>Cet article est sous license <a href="https://creativecommons.org/licenses/?lang=fr-FR" target="_blank">Creative Commons BY-NC-SA</a>. Il est ouvert à contribution en vous rendant sur ce lien : <a href="https://github.com/Chaine-de-Blocs/blocs.fr/blob/master/posts/2020-01-01-bitcoin-et-lightning-anonyme-avec-tor.mdx" target="_blank">Servir Bitcoin et Lightning Network en étant anonyme avec Tor</a></i></p></section><script type="text/javascript" data-isso="https://isso.blocs.fr/" src="//isso.blocs.fr/js/embed.min.js" data-isso-css="true" data-isso-lang="fr" data-isso-reply-notifications="true" async=""></script><div class="R"><h2>Commentaires</h2><p><i>(Le format <a href="https://www.christopheducamp.com/2014/09/18/love-markdown/" target="_blank">Markdown</a> est accepté)</i></p><section id="isso-thread"></section></div></body></html>